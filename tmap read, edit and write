import yaml
import copy

#Opening the Yaml File to Print out the Contents
def readYaml(filename):
    with open(filename) as fileReader:
        node_coords = yaml.load(fileReader, Loader=yaml.FullLoader)
        return (node_coords)

#Name all Nodes
def nodeNames(filename):
   #Recieves file data from read function
    data = readYaml(filename)
    #returns all nodes that exist in file
    return [node["meta"]["node"] for node in data]

#Generates all Numbers Attached to Waypoints, Finds the Next Unused Number
def nodeNumber(filename):
    data = readYaml(filename)
    #searches all "WayPoint" data and takes the numbers from the ends of those strings
    numbers = [int(node["meta"]["node"][8:]) for node in data]
    #puts numbers in order
    numbers.sort()
    #returns the next number in sequence
    return numbers[-1] + 1

#Editing Existing Data in the Yaml File
def editYaml(filename):
    nodeList = readYaml(filename)
    print("Choose a node to edit")
    print(nodeNames(filename))
    nodeName = input("Enter node: \n")
    newX = int(input("Enter new x value: \n"))
    newY = int (input("enter new y value: \n"))
    
    #Searches from the First to the Last Node
    for index in range(len(nodeList)):     
    #If the Node Matches with the Inputted Node
      if nodeList[index]["meta"]["node"] == nodeName:
          #Changing Variables to Match User Input
          nodeList[index]["node"]["pose"]["position"]["x"] = newX
          nodeList[index]["node"]["pose"]["position"]["y"] = newY
          print(nodeList[index]["node"]["pose"]["position"])
          
          #Opens "write" Stream 
          stream = open('riseholme.tmap', 'w')
          #Dumps New Yaml Data into File
          yaml.dump(nodeList, stream)   
          break


#Adding a New Node to The Yaml File
def writeYaml(filename):
  #Get User Input
    print("to make new node, enter x and y")
    newX = int(input("enter new x value: \n"))
    newY = int (input("enter new y value: \n"))

  #Gets File, Takes a Node to be Used as a Template for our New Node
    nodeList = readYaml(filename)
    newNode = copy.deepcopy(nodeList[0])
    #Calls next number in sequence of nodes to define this new one
    newNumber = nodeNumber(filename)
    
    #More attributes can be changed but I've started with node definition, name, x and y
    newNode["meta"]["node"] = "WayPoint"+str(newNumber)
    newNode["node"]["name"] = "WayPoint"+str(newNumber)
    newNode["node"]["pose"]["position"]["x"] = newX
    newNode["node"]["pose"]["position"]["y"] = newY
    #For testing the new node and the old one are different in the way you want
    print("\nNew Node:\n")
    print(newNode)   
    print("\nNode 1 for Comparison:\n")
    print(nodeList[0]) 
    
    #Appends new node to rest of the file then dumps into file
    nodeList.append(newNode)
    stream = open('riseholme.tmap', 'w')   
    yaml.dump(nodeList, stream)   


#Uncomment the function you wish to call
#All methods take file name to make file switching easy
writeYaml("riseholme.tmap")
#readYaml("riseholme.tmap")
#print(nodeNames("riseholme.tmap"))
#editYaml("riseholme.tmap")
#print(nodeNumber("riseholme.tmap"))
